<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.escape.login.mapper.MypageMapper">



<select id="getPersonByuser_idx" resultType="com.escape.login.domain.Person">
SELECT 
	PERSON_TB.*
FROM PERSON_TB
WHERE USER_IDX = #{user_idx}
</select>

<select id="getSellerByuser_idx" resultType="com.escape.login.domain.Seller">
SELECT 
	SELLER_IDX,
	USER_IDX,
	NAME,
	CNUM,
	PHONE,
	LOGO
FROM SELLER_TB
WHERE USER_IDX = #{user_idx}
</select>

<select id="getAirlineByuser_idx" resultType="com.escape.login.domain.Airline">
SELECT 
	AIRLINE_IDX,
	USER_IDX,
	NAME,
	CNUM,
	PHONE,
	LOGO 
FROM AIRLINE_TB
WHERE USER_IDX = #{user_idx}
</select>

<select id="getRoomByuser_idx">
select 
    room_tb.hotel_idx,
    room_tb.title,
    rr_tb.reservation_price,
    rr_tb.reservation_su,
    room_tb.max_preson,
    rr_tb.created
from
(select
   room_reservation_tb.room_idx,
    room_reservation_tb.reservation_su,
    room_reservation_tb.reservation_price,
    room_reservation_tb.created
from room_reservation_tb
where user_idx = #{user_idx}) rr_tb
left join room_tb 
on rr_tb.room_idx = room_tb.room_idx
</select>

<select id="getPkgByuser_idx">
select 
	package_tb.title,
    prtb.RESERVATION_SU,
    package_tb.start_date,    
    package_tb.end_date,
    package_tb.limited_person,
    prtb.RESERVATION_PRICE,
    package_tb.detail1,
    package_tb.detail2,
    package_tb.detail3,
    package_tb.zip_code, 
    prtb.CREATED
from
(select package_reservation_tb.*
from package_reservation_tb
where user_idx = #{user_idx}) prtb
left join package_tb
on prtb.package_idx = package_tb.package_idx
</select>

<select id="getAirtimeByuser_idx">
select     
    airplane_tb.name,
    reservation_su,
    reservation_price,
    created,
	start_date,
	start_time,
	end_date,
	end_time,
	departure_loc,
	arrival_loc
from
(select *
from
(select *
from AIRPLANE_RESERVATION_TB
where user_idx = #{user_idx}) attb
left join AIRPLANE_TIME_TB
on attb.AIRPLANE_TIME_IDX = AIRPLANE_TIME_TB.AIRPLANE_TIME_IDX) aa
left join AIRPLANE_TB
on AIRPLANE_TB.AIRPLANE_IDX = AA.AIRPLANE_IDX
</select>

<select id="getHotelByuser_idx">
select hotel_tb.*
from
(select hotel_bookmark_tb.hotel_idx
from hotel_bookmark_tb
where user_idx = #{user_idx}) hbtb
left join hotel_tb
on hotel_tb.hotel_idx = hbtb.hotel_idx
</select>

<select id="getPkgbookmarkByuser_idx">
select PACKAGE_TB.*
from
(select PACKAGE_BOOKMARK_TB.package_idx
from PACKAGE_BOOKMARK_TB
where user_idx = #{user_idx}) pbtb
left join PACKAGE_TB
on PACKAGE_TB.PACKAGE_IDX = pbtb.PACKAGE_IDX
</select>


<select id="getBoardVoByuser_idx">
select BOARD_TB.*
from BOARD_TB
where user_idx = #{user_idx}
</select>

<select id="getPkgBysellerUser_idx">
select PACKAGE_TB.*
from PACKAGE_TB
where user_idx = #{user_idx}
</select>










<update id="updateUser">
	UPDATE USER_TB
		SET 
	PASSWD = #{passwd},
	EMAIL = #{email}
		where user_idx = #{user_idx}
</update>

<update id="updatePerson">
	UPDATE PERSON_TB
		SET 
	FIRST_NAME = #{first_name},
	LAST_NAME = #{last_name},
	SOCIAL_NUM = #{social_num},
	PHONE = #{phone},
	ZIP_CODE = #{zip_code},
	ADDRESS1 = #{address1},
	ADDRESS2 = #{address2},
	NICKNAME = #{nickname}
		where person_idx = #{person_idx}
</update>

<update id="updateSeller">
	UPDATE SELLER_TB
		SET 
	NAME = #{name},
	CNUM = #{cnum},
	PHONE = #{phone},
	LOGO = #{logo}
		where user_idx = #{user_idx}
</update>

<update id="updateAirline">
	UPDATE AIRLINE_TB
		SET 
	NAME = #{name},
	CNUM = #{cnum},
	PHONE = #{phone},
	LOGO = #{logo}
		where user_idx = #{user_idx}
</update>




	
</mapper>
